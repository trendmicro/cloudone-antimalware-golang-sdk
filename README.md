# AMaaS Client for Golang


## Pre-Build Preparations

1. Replace \_\_JFROG_USER_EMAIL\_\_, and \_\_JFROG_API_KEY\_\_ with your own settings

    ``` bash
    export JFROG_USER_EMAIL=__JFROG_USER_EMAIL__
    export JFROG_API_KEY=__JFROG_API_KEY__
    export BUILD_MAJOR=1
    export BUILD_MINOR=0
    export BUILD_PATCH=0
    export BUILD_NUMBER=1

    ```

## Build Instructions

The following instructions assumes you are at the `<top level>/client/go` directory.

Multiple targets are supported by `Makefile.dev`:

1. To configure your environment to use ***local Client SDK for Golang module/package***, which requires modifying `src/go.mod` to point to `client/go/src/*`:

    ``` bash
    make -f Makefile.dev build
    ```
1. To use local module/package and also run unit tests:

    ``` bash
    make -f Makefile.dev test
    ```
1. To use local module/package to build the reference client tools, to be located in the `src/tools` directory after it's built:

    ``` bash
    make -f Makefile.dev build-tools
    ```
1. To build the Client SDK for Golang module/package, publish it to JFrog Artifactory `amaas-go-local` repo, and then run unit tests:

    ``` bash
    make -f Makefile.dev docker-publish
    ```

Options 1-3 also requires the installation of the following tools, in addition to Golang, on your own machines:

* [Protocol Buffer Compiler](https://grpc.io/docs/protoc-installation/)
* [Go plugins](https://grpc.io/docs/languages/go/quickstart/)

The build process will produce the following inside the `src/tools` directory:

* client
* scanfiles

## Usage Instructions for AMaaS Client Programs

### client

This program is located in the `src/tools` folder. It supports the gRPC-based AMaaS server.

`client [command-line flags]`

The following flags are supported:

  `-tls`
        Specify to enable server authentication by client for gRPC

  `-addr <string>`
        the address to connect to for gRPC (default "localhost:50051")

  `-filename <string>`
        Path of file to scan

  `-apikey <string>`
        API key for service authentication if authentication is enabled

### scanfiles

This is another program that uses the gRPC client library to communicate with AMaaS server. Depending on whether or not the `-good` flag is specified, and the scan result returned from the scan, the program will output result that shows the testing was successful or not.

If `-good` flag is specified, it indicates the files to be scanned are non-malicious. So if AMaaS server scan indicates a file is malicious, then the program will output result indicating the testing failed, for example.

The following flags are supported by the program:

  `-path <string>`
        Directory or file to scan. This flag must be specified in all scenarios.

  `-good`
        Specify if scanning good/non-malicious files.

  `-parallel`
        Specify if scanning of multiple files should be carried out simultaneously instead of sequentially.

  `-tls`
        Specify to enable server authentication by client for gRPC
  
  `-addr <string>`
        The address to connect to for gRPC (default "localhost:50051")

  `-apikey <string>`
        API key for service authentication if authentication is enabled
