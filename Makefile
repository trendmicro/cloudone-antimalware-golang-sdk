ROOT_DIR := $(abspath ../../)
include $(ROOT_DIR)/build-scripts/variables.mk

# As part of CI build, the value set here will probably never gets used if CI pipeline
# works correctly as designed.

AMAAS_GO_MODULE_VERSION_ID ?= $(BUILD_MAJOR).$(BUILD_MINOR).$(BUILD_PATCH)-$(BUILD_NUMBER)

IMAGE_NAME := amaas/amaas-go-client-sdk:latest


all: build clean

build:
	cp ../../protos/scan.proto ./
	docker build \
		-t $(IMAGE_NAME) \
		-f Dockerfile \
		--build-arg JFROG_USER_EMAIL=$(JFROG_USER_EMAIL) \
		--build-arg JFROG_API_KEY=$(JFROG_API_KEY) \
		--build-arg JFROG_GO_REGISTRY_PREFIX=$(JFROG_GO_REGISTRY_PREFIX) \
		--build-arg REGISTRY_ALL_AMAAS_GO_SUBDIR=$(REGISTRY_ALL_AMAAS_GO_SUBDIR) \
		--build-arg REGISTRY_LOCAL_AMAAS_GO_SUBDIR=$(REGISTRY_LOCAL_AMAAS_GO_SUBDIR) \
		--build-arg AMAAS_GO_MODULE_VERSION_ID=$(AMAAS_GO_MODULE_VERSION_ID) \
		.
	rm -f scan.proto

clean:
	rm -f ./scan.proto

.PHONY: all build clean
