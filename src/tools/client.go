package main

import (
	"flag"
	"log"
	"os"

	amaasclient "github.com/trendmicro/amaas/client"
)

var (
	addr      = flag.String("addr", "localhost:50051", "the address to connect to")
	apiKey    = flag.String("apikey", "", "API key for service authentication")
	fileName  = flag.String("filename", os.Args[0], "file to scan")
	enableTLS = flag.Bool("tls", false, "enable TLS")
)

func main() {
	flag.Parse()

	client, err := amaasclient.NewClientInternal(*apiKey, *addr, *enableTLS)
	if err != nil {
		log.Printf("Problem creating scan client object: %v", err)
		os.Exit(1)
	}

	result, err := client.ScanFile(*fileName)
	if err != nil {
		log.Printf(err.Error())
		os.Exit(1)
	}

	log.Printf("%s\n", result)

	client.Destroy()
}
